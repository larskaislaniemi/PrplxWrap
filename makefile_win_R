#CC=gcc
CC=c:\\MinGW\\bin\\mingw32-g++.exe
RCC=$(CC)
#PROFILEROPT=-pg
PROFILEROPT=
MEX=mex
OPTDEF=-DUSE_LPOPT_WARM_START=1
#OPTDEF=
OPTIMIZATION=-g
CFLAGS=-std=gnu11 -c -Wall $(OPTIMIZATION) -fPIC $(OPTDEF) $(PROFILEROPT)
MFLAGS=-lgfortran
LDFLAGS=-lgfortran $(OPTIMIZATION) $(PROFILEROPT)
SOURCES=perplex.c 
MSOURCES=m_ini_phaseq.c
RSOURCES=Rperplex.c
RINCDIR=../R-3.0.2/src/include
RLIBDIR=../R-3.0.2/src/lib
RCFLAGS=-I$(RINCDIR) -std=gnu99
RLDFLAGS=-L/usr/lib/R/lib -lR
OBJECTS=$(SOURCES:.c=.o)
ROBJECTS=$(RSOURCES:.c=.o)
RSHLIB=$(RSOURCES:.c=.so)
SHLIB=libperplex.so
SHDLL=libperplex.dll
RSHDLL=Rperplex.dll
PERPLEXSRC=../perplex668
PERPLEXOBJECTS=$(PERPLEXSRC)/meemum.o
#PERPLEXOBJECTS=
EXECUTABLE=

all: $(OBJECTS) $(ROBJECTS) $(SHLIB) $(RSHLIB)

clean:
	rm -f $(OBJECTS) $(ROBJECTS) $(RSHLIB) $(EXECUTABLE)

Robj: $(RSOURCES) $(PERPLEXOBJECTS)
	$(CC) $(CFLAGS) $(RCFLAGS) $(RSOURCES)

obj: $(SOURCES) $(PERPLEXOBJECTS) 
	$(CC) $(CFLAGS) $(SOURCES)

shared: $(OBJECTS)
	$(CC) $(OPTIMIZATION) -shared -o $(SHLIB) $(OBJECTS) $(PERPLEXOBJECTS) $(LDFLAGS)

Rshared: $(OBJECTS) $(ROBJECTS) $(PERPLEXOBJECTS)
	$(RCC) $(OPTIMIZATION) -shared -o $(RSHLIB) $(ROBJECTS) $(OBJECTS) $(PERPLEXOBJECTS) $(LDFLAGS) $(RLDFLAGS)

shareddll: $(OBJECTS)
	$(CC) $(OPTIMIZATION) -shared -o $(SHDLL) $(OBJECTS) $(PERPLEXOBJECTS) $(LDFLAGS)

Rshareddll: $(OBJECTS) $(ROBJECTS) $(PERPLEXOBJECTS)
	 $(RCC) $(OPTIMIZATION) -shared -o $(RSHDLL) $(ROBJECTS) $(OBJECTS) $(PERPLEXOBJECTS) $(LDFLAGS) $(RLDFLAGS)

matlab: $(OBJECTS) $(PERPLEXOBJECTS) $(MSOURCES)
	$(MEX) $(MFLAGS) $(MSOURCES) $(OBJECTS) $(PERPLEXOBJECTS)

$(EXECUTABLE): $(OBJECTS) $(PERPLEXOBJECTS)
	$(CC) $(LDFLAGS) $(OBJECTS) $(PERPLEXOBJECTS) -o $@

	#.c.o:
	#$(CC) $(CFLAGS) $< -o $@

